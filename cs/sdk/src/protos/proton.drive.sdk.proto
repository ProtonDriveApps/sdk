edition = "2023";
package proton.sdk.drive;

option features.utf8_validation = NONE;
option csharp_namespace = "Proton.Sdk.Drive.CExports";

import "proton.sdk.proto";

message Request {
    oneof payload {
        DriveClientCreateRequest DriveClientCreate = 100;
        DriveClientFreeRequest DriveClientFree = 101;
        DriveClientGetFileUploaderRequest DriveClientGetFileUploader = 102;
        DriveClientGetFileRevisionUploaderRequest DriveClientGetFileRevisionUploader = 103;
        DriveClientGetFileDownloaderRequest DriveClientGetFileDownloader = 104;

        UploadFromStreamRequest UploadFromStream = 200;
        FileUploaderFreeRequest FileUploaderFree = 201;
        UploadControllerAwaitCompletionRequest UploadControllerAwaitCompletion = 202;
        UploadControllerPauseRequest UploadControllerPause = 203;
        UploadControllerResumeRequest UploadControllerResume = 204;
        UploadControllerFreeRequest UploadControllerFree = 205;

        DownloadToStreamRequest DownloadToStream = 300;
        FileDownloaderFreeRequest FileDownloaderFree = 301;
        DownloadControllerAwaitCompletionRequest DownloadControllerAwaitCompletion = 302;
        DownloadControllerPauseRequest DownloadControllerPause = 303;
        DownloadControllerResumeRequest DownloadControllerResume = 304;
        DownloadControllerFreeRequest DownloadControllerFree = 305;
    };
}

message CallbackResponse {
    oneof payload {
        StreamReadResponse StreamRead = 100;
        StreamWriteResponse StreamWrite = 101;
    };
}

message RevisionUploaderProvisionRequest {
    string file_uid = 1;
    int64 file_size = 2;
    int64 last_modification_date = 3;
}

message ProgressUpdate {
    int64 bytes_completed = 1;
    int64 bytes_in_total = 2;
}

message Thumbnail {
    int32 type = 1;
    int64 content_pointer = 2;
}

// Drive - client

// The response value will be an Int64Value message.
message DriveClientCreateRequest {
    int64 session_handle = 1;
}

// No response value.
message DriveClientFreeRequest {
    int64 client_handle = 1;
}

// Drive - uploads

// The response value will be an Int64Value message.
message DriveClientGetFileUploaderRequest {
    int64 client_handle = 1;
    string parent_folder_uid = 2;
    string name = 3;
    string mediaType = 4;
    int64 size = 5;
    int64 last_modification_time = 6;
    bool override_existing_draft_by_other_client = 7;
    int64 cancellation_token_source_handle = 8;
}

// The response value will be an Int64Value message.
message DriveClientGetFileRevisionUploaderRequest {
    int64 client_handle = 1;
    string current_active_revision_uid = 2;
    int64 file_size = 3;
    int64 last_modification_time = 4;
    int64 cancellation_token_source_handle = 5;
}

// The response value will be an Int64Value message.
message UploadFromStreamRequest {
    int64 uploader_handle = 1;
    repeated Thumbnail thumbnails = 2;
    int64 read_callback = 3; // C signature: void on_stream_operation(const void* state, ByteArray buffer, const void* caller_state);
    int64 progress_callback = 4; // See array_callback_function in C header file for signature
    int64 cancellation_token_source_handle = 5;
}

// No response value.
message FileUploaderFreeRequest {
    int64 file_uploader_handle = 1;
}

// The response value will be a Node message.
message UploadControllerAwaitCompletionRequest {
    int64 upload_controller_handle = 1;
}

// No response value.
message UploadControllerPauseRequest {
    int64 upload_controller_handle = 1;
}

// No response value.
message UploadControllerResumeRequest {
    int64 upload_controller_handle = 1;
}

// No response value.
message UploadControllerFreeRequest {
    int64 upload_controller_handle = 1;
}

// Drive - downloads

// The response value will be an Int64Value message.
message DriveClientGetFileDownloaderRequest {
    int64 client_handle = 1;
    string revision_uid = 2;
    int64 cancellation_token_source_handle = 3;
}

// The response value will be an Int64Value message.
message DownloadToStreamRequest {
    int64 downloader_handle = 1;
    int64 write_callback = 2; // C signature: void on_stream_operation(const void* state, ByteArray buffer, const void* caller_state);
    int64 progress_callback = 3; // See array_callback_function in C header file for signature
    int64 cancellation_token_source_handle = 4;
}

// No response value.
message FileDownloaderFreeRequest  {
    int64 file_downloader_handle = 1;
}

// No response value.
message DownloadControllerAwaitCompletionRequest {
    int64 download_controller_handle = 1;
}

// No response value.
message DownloadControllerPauseRequest {
    int64 download_controller_handle = 1;
}

// No response value.
message DownloadControllerResumeRequest {
    int64 download_controller_handle = 1;
}

// No response value.
message DownloadControllerFreeRequest {
    int64 download_controller_handle = 1;
}

// The response must be a StreamReadResponse message.
message StreamReadRequest {
    int64 buffer_pointer = 1;
    int32 buffer_length = 2;
}

// The response must be a StreamWriteResponse message.
message StreamWriteRequest {
    int64 data_pointer = 1;
    int32 data_length = 2;
}

message StreamReadResponse {
    oneof result {
        int32 BytesRead = 1;
        proton.sdk.Error Error = 2;
    }
}

message StreamWriteResponse {
    proton.sdk.Error error = 1; // Optional
}
